#include <iostream>
#include "ttt.h"
using namespace std;

//Constructor
//Initializes TTT board
TicTacToe::TicTacToe()
{
    int num = 1;
    for(int row = 0; row < MAX; row++)
    {
        for(int col = 0; col < MAX; col++)
        {
            Board[row][col] = '0' + num;
            num++;
        }

    }

}
//Destructor
TicTacToe::~TicTacToe()

    { 
    //nothing to do since its static array
    }

// Purpose: Resets the board to empty spaces
void TicTacToe::resetBoard()
{
    int num = 1;
    for(int row = 0; row < MAX; row++)
    {
        for(int col = 0; col < MAX; col++)
        {
            Board[row][col] = '0' + num;
            num++;
        }
    }
}

//Displays the state of the board, in correct format
void TicTacToe::displayBoard()
{
    cout << endl;
     for(int row = 0; row < MAX; row++)
    {
        cout <<"     ";
    
        for(int col = 0; col < MAX; col++)
        {
            cout<<" "<< Board[row][col];
            if(col < MAX- 1)
            cout <<" |";
        }
        cout << endl;
        if (row < MAX - 1)
           
        { cout <<"     ";
            cout <<"---|---|---" << endl;
        }
        
        
    }  
    cout << endl; 
}
//Purpose: checks if the cell is empty before placing mark
bool TicTacToe::cellEmpty(int row, int col)
{

return (Board[row][col] != 'X' && Board[row][col] != 'O');

}

//Purpose: Takes players choice of placement and places the mark in the corrct spot of the 
//matrix
void TicTacToe::playerMove()
{
    int position;
    int row;
    int col;

    cout <<"Please enter a position to place your 'X' \n ==>"<< endl;
    cin >> position;

    int index = position -1;
    row = index / 3;
    col = index % 3;

    if(cellEmpty(row, col))
   { Board[row][col] = 'X';}
    else{
        cout<<"That position is already taken!"<< endl;
    }
}
 
//Checks if the player or compute have won, checks symbols 'O' or 'X'   
bool TicTacToe::hasWinner(char symbol)
{

for(int row = 0; row < MAX; row++)
    {
        if(Board[row][0] == symbol && Board[row][1] == symbol && Board[row][2] == symbol)
                return true;         
    }
for(int col = 0; col < MAX; col++)
    {
           if(Board[0][col] == symbol && Board[1][col] == symbol && Board[2][col] == symbol)
           return true;

    }
    if(Board[0][0] == symbol && Board[1][1]== symbol && Board[2][2] == symbol)
        return true;
    if(Board[0][2] == symbol && Board[1][1] == symbol && Board[2][0] == symbol)
        return true;

    return false;

}
//Purpose: Checks if the game is a draw. If board is full with no symbols matching
//In a winning combo, its a draw
bool TicTacToe::isDraw()
{
    for(int row = 0; row < MAX; row++)
        for(int col = 0; col < MAX; col++)
            if(Board[row][col] != 'X' && Board [row][col] != 'O')
            return false;
    return true;



}

//Allows the computer to make a move while taking preventWin() 
//to see if the player is close to a win
void TicTacToe::CompMove()
{
   int row, col;
    
    // Block if needed
    if (preventWin(row, col))
    {
        Board[row][col] = 'O';
        return;
    }
    
    // Otherwise take first empty spot
    for (row = 0; row < MAX; row++)
    {
        for (col = 0; col < MAX; col++)
        {
            if (cellEmpty(row, col))
            {
                Board[row][col] = 'O';
                return;
            }
        }
    }
}

//Checks for a possible win by player and moves to put a 'O' symbol where a win
//is possible
bool TicTacToe::preventWin(int& row, int& col)
{
    //Check each row
    for(int r = 0; r < MAX; r++)
    {
        int xCount = 0;
        int emptyCol = -1;

        for (int c = 0; c < MAX; c++)
        {
            if(Board[r][c] == 'X')
                xCount++;
            else if(cellEmpty(r,c))
                emptyCol = c;
        }

        if(xCount == 2 && emptyCol != -1)
        {
            row = r;
            col = emptyCol;
            return true;
        }
    }
    
    //Check each Col
    for(int c = 0; c < MAX; c++)
    {
        int xCount = 0;
        int emptyRow = -1;

        for (int r = 0; r < MAX; r++)
        {
            if(Board[r][c] == 'X')
                xCount++;
            else if(cellEmpty(r, c))
                emptyRow = r;
        }

        if(xCount == 2 && emptyRow != -1)
        {
            row = emptyRow;
            col = c;
            return true;
        }
    }
    
    //Check diagonals
    int xCount = 0;
    int emptyR = -1, emptyC = -1;

    for (int r = 0; r < MAX; r++)
    {
        if (Board[r][r] == 'X')
            xCount++;
        else if (cellEmpty(r, r))
        {
            emptyR = r;
            emptyC = r;
        }
    }

    if (xCount == 2 && emptyR != -1)
    {
        row = emptyR;
        col = emptyC;
        return true;
    }
    
   
    xCount = 0;
    emptyR = -1;
    emptyC = -1;

    for (int r = 0; r < MAX; r++)
    {
        int c = MAX - 1 - r;
        
        if (Board[r][c] == 'X')
            xCount++;
        else if (cellEmpty(r, c))
        {
            emptyR = r;
            emptyC = c;
        }
    }

    if (xCount == 2 && emptyR != -1)
    {
        row = emptyR;
        col = emptyC;
        return true;
    }
    
    return false;  
}
